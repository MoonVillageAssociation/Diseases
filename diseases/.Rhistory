axis.text.x = element_text(angle = 45, hjust = 1),
legend.title = element_text(size = 12)
) +
guides(fill = guide_legend(title = "Chemical Name"))
print(hpo_rel_plot_cns)
# Save
ggsave(
"HPO_analysis/normalized_chemical_contributions_CNS.png",
plot = hpo_rel_plot_cns,
width = 12, height = 6, dpi = 300
)
# Count all CNS occurrences
cns_total_count <- df_cns %>%
filter(class == "CNS") %>%
nrow()
cns_in_all_pct <- cns_total_count / nrow(df_cns) * 100
print(sprintf(
"%.1f%% of all HPO occurrences are classified as CNS (%d out of %d).",
cns_in_all_pct, cns_total_count, nrow(df_cns)
))
# Within CNS: breakdown by source class (Brain vs Mental vs Eye-selected)
cns_breakdown <- df_cns %>%
mutate(
cns_source = case_when(
class == "CNS" & (description %in% eye_cns_selected) ~ "Eye (CNS-selected)",
class == "CNS" & (description %in% unique(df$description[df$class == "Eye"])) ~ "Eye (CNS-selected)",
TRUE ~ NA_character_
)
)
# More robust: compute sources directly from original df
cns_sources <- df %>%
mutate(
cns_source = case_when(
class == "Brain" ~ "Brain",
class == "Mental" ~ "Mental",
class == "Eye" & description %in% eye_cns_selected ~ "Eye (CNS-selected)",
TRUE ~ NA_character_
)
) %>%
filter(!is.na(cns_source))
print(cns_sources %>% count(cns_source, sort = TRUE))
# Percent of CNS occurrences that come from each source
print(
cns_sources %>%
count(cns_source, name = "n") %>%
mutate(pct = n / sum(n) * 100) %>%
arrange(desc(n))
)
cns_pie_data <- cns_sources %>%
count(cns_source, name = "n") %>%
mutate(
pct = n / sum(n) * 100,
label = paste0(cns_source, " (", percent(pct / 100, accuracy = 0.1), ")")
) %>%
arrange(desc(n))
cns_sources_pie <- ggplot(cns_pie_data, aes(x = "", y = n, fill = cns_source)) +
geom_col(width = 1) +
coord_polar(theta = "y") +
labs(
title = "CNS Occurrences by Source (Brain vs Mental vs Eye-selected)",
x = NULL,
y = NULL
) +
theme_minimal(base_size = 14) +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.title = element_text(size = 12)
) +
guides(fill = guide_legend(title = "CNS Source"))
print(cns_sources_pie)
cns_pie_data <- cns_sources %>%
count(cns_source, name = "n") %>%
mutate(
pct = n / sum(n) * 100,
label = paste0(cns_source, "\n", "n = ", n, " | ", percent(pct / 100, accuracy = 0.1))
) %>%
arrange(desc(n))
cns_sources_pie <- ggplot(cns_pie_data, aes(x = "", y = n, fill = cns_source)) +
geom_col(width = 1) +
coord_polar(theta = "y") +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
lineheight = 0.95) +
labs(
title = "CNS Occurrences by Source (Brain vs Mental vs Eye-selected)",
x = NULL,
y = NULL
) +
theme_minimal(base_size = 14) +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.5),
legend.title = element_text(size = 12)
) +
guides(fill = guide_legend(title = "CNS Source"))
print(cns_sources_pie)
ggsave(
"HPO_analysis/cns_sources_pie.png",
plot = cns_sources_pie,
width = 8, height = 6, dpi = 300
)
cns_sources_pie <- ggplot(cns_pie_data, aes(x = "", y = n, fill = cns_source)) +
geom_col(width = 1) +
coord_polar(theta = "y") +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
lineheight = 0.95) +
labs(
title = "CNS Occurrences by Source (Brain vs Mental vs Eye-selected)",
x = NULL,
y = NULL
) +
theme_minimal(base_size = 14) +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.25),
legend.title = element_text(size = 12)
) +
guides(fill = guide_legend(title = "CNS Source"))
print(cns_sources_pie)
ggsave(
"HPO_analysis/cns_sources_pie.png",
plot = cns_sources_pie,
width = 8, height = 6, dpi = 300
)
cns_sources_pie <- ggplot(cns_pie_data, aes(x = "", y = n, fill = cns_source)) +
geom_col(width = 1) +
coord_polar(theta = "y") +
geom_text(aes(label = label),
position = position_stack(vjust = 0.5),
size = 4,
lineheight = 0.95) +
labs(
title = "CNS Occurrences by Source (Brain vs Mental vs Eye-selected)",
x = NULL,
y = NULL
) +
theme_minimal(base_size = 14) +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.title = element_text(hjust = 0.2),
legend.title = element_text(size = 12)
) +
guides(fill = guide_legend(title = "CNS Source"))
print(cns_sources_pie)
ggsave(
"HPO_analysis/cns_sources_pie.png",
plot = cns_sources_pie,
width = 8, height = 6, dpi = 300
)
# Read data
df <- read_csv("StringDB_results/ALL_DISEASES.csv")
class_map <- read_csv("DISEASES_terms_classified.csv")
df <- df %>%
select(-any_of("term"))
class_map <- class_map %>%
mutate(
class = str_replace_all(class, "\\s*;\\s*", ";")
)
# Join and coalesce categories and remove genetic disorders
df <- df %>%
left_join(class_map, by = "description", suffix = c(".db", ".map")) %>%
mutate(
class = str_replace_all(class, "\\s*;\\s*", ";")
) %>%
select(-any_of(c("class.map", "class.db"))) %>%
filter(`class` != "Genetic Disorder")
# Expand multi-class rows
df_expanded <- df %>%
separate_rows(class, sep = ";") %>%
filter(!is.na(class), class != "")
# Get top 10 categories
top_categories <- df_expanded %>%
count(class, sort = TRUE) %>%
slice_max(n, n = 10) %>%
pull(class)
# Filter to top 10 categories
filtered_df <- df_expanded %>%
filter(class %in% top_categories)
# Count (class, ChemicalName)
stacked_data <- filtered_df %>%
count(class, ChemicalName)
# Reorder categories by total count
class_order <- stacked_data %>%
group_by(class) %>%
summarise(total = sum(n), .groups = "drop") %>%
arrange(desc(total)) %>%
pull(class)
# Convert class column to factor with correct order
stacked_data$class <- factor(stacked_data$class, levels = class_order)
# Plot stacked bar chart
chemical_contributions_stacked_bar <- ggplot(stacked_data, aes(
x = n,
y = class,
fill = ChemicalName
)) +
geom_bar(stat = "identity") +
labs(
title = "Chemical Contributions in Top 10 Disease Categories",
x = "Number of Occurrences",
y = "class"
) +
scale_x_continuous(expand = c(0, 0)) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(size = 12),
axis.text.y = element_text(size = 12)
) +
guides(fill = guide_legend(title = "Chemical Name"))
print(chemical_contributions_stacked_bar)
# Save plot
ggsave(
"DISEASES_analysis/chemical_contributions_stacked_bar.png",
plot = chemical_contributions_stacked_bar,
width = 10, height = 6, dpi = 300
)
# Top 10 categories by absolute count
top_categories_rel <- df_expanded %>%
count(class, name = "total") %>%
slice_max(total, n = 10) %>%
pull(class)
# Filter to those categories
filtered_rel <- df_expanded %>%
filter(class %in% top_categories_rel)
# Count (class, ChemicalName) pairs
contributions_rel <- filtered_rel %>%
count(class, ChemicalName, name = "n")
# Normalize within each class
normalized_rel <- contributions_rel %>%
group_by(class) %>%
mutate(share = n / sum(n)) %>%
ungroup()
# Order categories by total occurrences (same order as absolute totals)
class_order_rel <- contributions_rel %>%
group_by(class) %>%
summarise(total = sum(n), .groups = "drop") %>%
arrange(desc(total)) %>%
pull(class)
normalized_rel$class <- factor(normalized_rel$class, levels = class_order_rel)
# Plot normalized stacked bar (vertical)
p_rel <- ggplot(normalized_rel, aes(x = class, y = share, fill = ChemicalName)) +
geom_col(width = 0.7) +
labs(
title = "Relative Chemical Contributions in Top 10 Disease Categories",
x = "class",
y = "Relative Share"
) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust = 1),
legend.title = element_text(size = 12)
) +
guides(fill = guide_legend(title = "Chemical Name"))
print(p_rel)
# Save
ggsave("DISEASES_analysis/normalized_chemical_contributions.png", plot = p_rel, width = 12, height = 6, dpi = 300)
# Count total neurological disorders
neurological_total_count <- df_expanded %>%
filter(class == "Neurological Disease") %>%
nrow()
neuro_in_all_pct <- neurological_total_count / nrow(df) * 100
print(sprintf(
"%.1f%% of all diseases are classified as neurological disorders (%d out of %d).",
neuro_in_all_pct, neurological_total_count, nrow(df)
))
# Define the list of disease descriptions linked to protein misfolding disorders (PMDs)
protein_formation_descriptions <- c(
"Prion disease", "Primary cutaneous amyloidosis",
"APP-related cerebral amyloid angiopathy",
"Alzheimers disease", "Creutzfeldtâ€“Jakob disease",
"Lewy body dementia", "Neurodegenerative disease",
"ITM2B-related cerebral amyloid angiopathy 2",
"CST3-related cerebral amyloid angiopathy",
"ITM2B-related cerebral amyloid angiopathy 1",
"Parkinsons disease", "Familial visceral amyloidosis",
"Amyloidosis", "Dementia", "Vascular dementia",
"Frontotemporal dementia"
)
# Count how many neurological disorders are related to PMDs
protein_formation_in_neuro_count <- df_expanded %>%
filter(class == "Neurological Disease") %>%
filter(grepl(
paste(protein_formation_descriptions, collapse = "|"),
description,
ignore.case = TRUE
)) %>%
nrow()
# Calculate the proportion
pmd_in_neuro_pct <- protein_formation_in_neuro_count / neurological_total_count * 100
# Print result
print(sprintf(
"%.1f%% of neurological disorders occurences are related to protein misfolding disorders (PMDs) (%d out of %d occurences).",
pmd_in_neuro_pct, protein_formation_in_neuro_count, neurological_total_count
))
# Count all diseases related to PMDs
protein_formation_total_count <- df_expanded %>%
filter(grepl(
paste(protein_formation_descriptions, collapse = "|"),
description,
ignore.case = TRUE
)) %>%
nrow()
# Calculate the proportion
pmd_in_all_pct <- protein_formation_total_count / nrow(df) * 100
# Print result
print(sprintf(
"%.1f%% of all disease occurences are related to protein misfolding disorders (PMDs) (%d out of %d occurences).",
pmd_in_all_pct, protein_formation_total_count, nrow(df)
))
# Count all hematologic diseases
hematologic_total_count <- df_expanded %>%
filter(class == "Hematologic Disease") %>%
nrow()
hema_in_all_pct <- hematologic_total_count / nrow(df) * 100
print(sprintf(
"%.1f%% of all diseases are classified as hematologic disorders (%d out of %d).",
hema_in_all_pct, hematologic_total_count, nrow(df)
))
# Percentage of hematologic diseases that are anemia
anemia_count <- df_expanded %>%
filter(class == "Hematologic Disease") %>%
filter(grepl("anemia", description, ignore.case = TRUE)) %>%
nrow()
anemia_pct <- anemia_count / hematologic_total_count * 100
print(sprintf(
"%.1f%% of hematologic diseases are a type of anemia (%d out of %d).",
anemia_pct, anemia_count, hematologic_total_count
))
# Percentage of hematologic diseases that are cancers
hematologic_cancer_terms <- c(
"Hematologic cancer", "Leukemia", "Lymphatic system cancer",
"Lymphoma", "non-Hodgkin lymphoma",
"Mature T-cell and NK-cell lymphoma"
)
hematologic_cancer_count <- df_expanded %>%
filter(class == "Hematologic Disease") %>%
filter(grepl(
paste(hematologic_cancer_terms, collapse = "|"),
description,
ignore.case = TRUE
)) %>%
nrow()
hematologic_cancer_pct <- hematologic_cancer_count / hematologic_total_count * 100
print(sprintf(
"%.1f%% of hematologic diseases are cancers (%d out of %d).",
hematologic_cancer_pct, hematologic_cancer_count, hematologic_total_count
))
# Print total hematologic cancer occurrences (explicitly)
print(sprintf(
"Total hematologic cancer occurrences (subset of hematologic): %d.",
hematologic_cancer_count
))
## Total cancer occurrences
cancer_total_count <- df_expanded %>%
filter(class == "Cancer") %>%
nrow()
cancer_in_all_pct <- cancer_total_count / nrow(df) * 100
print(sprintf(
"%.1f%% of all diseases are classified as cancers (%d out of %d).",
cancer_in_all_pct, cancer_total_count, nrow(df)
))
# Percentage of hematologic cancers among all cancers
hematologic_cancer_terms <- c(
"Hematologic cancer",
"Leukemia",
"Lymphatic system cancer",
"Lymphoma",
"Mature T-cell and NK-cell lymphoma",
"non-Hodgkin lymphoma"
)
# Percentage of hematologic cancers among all cancers
hematologic_cancer_terms <- c(
"Hematologic cancer",
"Leukemia",
"Lymphatic system cancer",
"Lymphoma",
"Mature T-cell and NK-cell lymphoma",
"non-Hodgkin lymphoma"
)
## Hematological cancer occurrences among all cancers
hematologic_cancers_count <- df_expanded %>%
filter(class == "Cancer") %>%
filter(description %in% hematologic_cancer_terms) %>%
nrow()
hematologic_among_all_cancers_pct <- hematologic_cancers_count / cancer_total_count * 100
print(sprintf(
"%.1f%% of all cancer occurrences are hematological cancers (%d out of %d).",
hematologic_among_all_cancers_pct, hematologic_cancers_count, cancer_total_count
))
# Create CNS-labeled version of df_expanded (DO NOT overwrite df_expanded)
df_expanded_cns <- df_expanded %>%
mutate(
class = if_else(
class %in% c("Neurological Disease", "Mental Health Disorder"),
"CNS Disease",
class
)
)
# Get top 10 categories
top_categories_cns <- df_expanded_cns %>%
count(class, sort = TRUE) %>%
slice_max(n, n = 10) %>%
pull(class)
# Filter to top 10 categories
filtered_df_cns <- df_expanded_cns %>%
filter(class %in% top_categories_cns)
# Count (class, ChemicalName)
stacked_data_cns <- filtered_df_cns %>%
count(class, ChemicalName)
# Reorder categories by total count
class_order_cns <- stacked_data_cns %>%
group_by(class) %>%
summarise(total = sum(n), .groups = "drop") %>%
arrange(desc(total)) %>%
pull(class)
# Convert class column to factor with correct order
stacked_data_cns$class <- factor(stacked_data_cns$class, levels = class_order_cns)
# Plot stacked bar chart
chemical_contributions_stacked_bar_cns <- ggplot(stacked_data_cns, aes(
x = n,
y = class,
fill = ChemicalName
)) +
geom_bar(stat = "identity") +
labs(
title = "Chemical Contributions in Top 10 Disease Categories",
x = "Number of Occurrences",
y = "class"
) +
scale_x_continuous(expand = c(0, 0)) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(size = 12),
axis.text.y = element_text(size = 12)
) +
guides(fill = guide_legend(title = "Chemical Name"))
print(chemical_contributions_stacked_bar_cns)
# Save plot
ggsave(
"DISEASES_analysis/chemical_contributions_stacked_bar_CNS.png",
plot = chemical_contributions_stacked_bar_cns,
width = 10, height = 6, dpi = 300
)
# Top 10 categories by absolute count
top_categories_rel_cns <- df_expanded_cns %>%
count(class, name = "total") %>%
slice_max(total, n = 10) %>%
pull(class)
# Filter to those categories
filtered_rel_cns <- df_expanded_cns %>%
filter(class %in% top_categories_rel_cns)
# Count (class, ChemicalName) pairs
contributions_rel_cns <- filtered_rel_cns %>%
count(class, ChemicalName, name = "n")
# Normalize within each class
normalized_rel_cns <- contributions_rel_cns %>%
group_by(class) %>%
mutate(share = n / sum(n)) %>%
ungroup()
# Order categories by total occurrences (same order as absolute totals)
class_order_rel_cns <- contributions_rel_cns %>%
group_by(class) %>%
summarise(total = sum(n), .groups = "drop") %>%
arrange(desc(total)) %>%
pull(class)
normalized_rel_cns$class <- factor(normalized_rel_cns$class, levels = class_order_rel_cns)
# Plot normalized stacked bar (vertical)
p_rel_cns <- ggplot(normalized_rel_cns, aes(x = class, y = share, fill = ChemicalName)) +
geom_col(width = 0.7) +
labs(
title = "Relative Chemical Contributions in Top 10 Disease Categories (CNS = Neurological + Mental)",
x = "class",
y = "Relative Share"
) +
scale_y_continuous(labels = percent_format(accuracy = 1)) +
theme_minimal(base_size = 14) +
theme(
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust = 1),
legend.title = element_text(size = 12)
) +
guides(fill = guide_legend(title = "Chemical Name"))
print(p_rel_cns)
# Save
ggsave(
"DISEASES_analysis/normalized_chemical_contributions_CNS.png",
plot = p_rel_cns,
width = 12, height = 6, dpi = 300
)
View(df_expanded)
print(sprintf(
"%.1f%% of all diseases are classified as neurological disorders (%d out of %d).",
neuro_in_all_pct, neurological_total_count, nrow(df)
))
View(df)
pwd()
dir()
